import { Button, VStack } from '@chakra-ui/react';
import PasswordInput from './PasswordInput';
import PseudoInput from './PseudoInput';

import { gql, useMutation } from '@apollo/client';
import { FormEventHandler } from 'react';


type Inputs = {
  pseudo: string;
  password: string;
};

const LOGIN_MUTATION = gql`
  mutation ($email: String!, $password: String!) {
    login(email: $email, password: $password) {
      token
      user {
        id
      }
    }
  }
`;

const Form = () => {
  const [login] = useMutation(LOGIN_MUTATION);

  const handleSubmit: FormEventHandler<HTMLFormElement> = (e) => {
    e.preventDefault();
    const target = e.target as any;
    const email = target[0].value as string;
    const password = target[1].value as string;

    const data = {
      email,
      password
    }

    login({
      variables: data,
      onCompleted: ({ login }) => {
        console.log(login);
      },
      onError: (error) => {
        console.log(error);
      },
    });

  };

  return (
    <form onSubmit={handleSubmit} action=''>
      <VStack spacing='1rem'>
        <PseudoInput />
        <PasswordInput />
        <Button type='submit' colorScheme='blue'>
          Se connecter
        </Button>
      </VStack>
    </form>
  );
};

export default Form;
