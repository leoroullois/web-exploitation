FROM node:16-alpine

ENV PORT 5000

RUN mkdir -p /usr/src/app
WORKDIR /usr/src/app/

COPY . /usr/src/app/
RUN npm i -g pnpm ts-node @types/node && pnpm install

RUN pnpm run prisma && pnpm run prisma generate --schema ./prisma/schema.prisma && pnpm run generate
RUN yarn prisma migrate dev
# RUN yarn migrate:deploy && yarn build
RUN ts-node src/script.ts

EXPOSE 5000

CMD ["pnpm", "run", "dev"]
