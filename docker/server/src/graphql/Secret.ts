import { extendType, objectType } from 'nexus';

export const Secret = objectType({
  name: "Secret",
  definition(t) {
    t.nonNull.string("message");
    t.nonNull.string("flag");
  },
});

export const SecretQuery = extendType({
  type: "Query",
  definition(t) {
    t.nonNull.field("secret", {
      type: "Secret",
      resolve(_, __, ctx) {
        if (!ctx.userId) {
           throw new Error("Not authenticated");
        }

        if(ctx.userId !== 1) {
          throw new Error("Not authorized. You can't access this secret since you are not an admin.");
        }

        return {
          message: "Well done ! You've just solve the challenge. Validate with the flag.",
          flag: "flag{JwT_1s_N0t_S0_@S3cur3}",
        };
      },
    });
  },
});
