import { Request, Response } from "express";

import { PrismaClient } from "@prisma/client";

import { decodeAuthHeader } from "./utils/auth";

export const prisma = new PrismaClient();

export interface Context {
   prisma: PrismaClient;
   userId?: number;
   req: Request;
   res: Response;
}

export const context = ({
   req,
   res,
}: {
   req: Request;
   res: Response;
}): Context => {
   const { token }: { token: string } = req.cookies;
   const decoded = token ? decodeAuthHeader(token) : null;
   
   return {
      prisma,
      userId: decoded ? Number(decoded.userId) : undefined,
      req,
      res,
   };
};

