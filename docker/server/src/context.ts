import { Request, Response } from "express";
import Cookie from "js-cookie";

import { PrismaClient } from "@prisma/client";

import { decodeAuthHeader } from "./utils/auth";

export const prisma = new PrismaClient();

export interface Context {
   prisma: PrismaClient;
   userId?: string;
   req: Request;
   res: Response;
}

export const context = ({
   req,
   res,
}: {
   req: Request;
   res: Response;
}): Context => {
   // const token2 =
   //    req && req.headers.authorization
   //       ? decodeAuthHeader(req.headers.authorization)
   //       : null;
   const { token }: { token: string } = req.cookies;
   const decoded = token ? decodeAuthHeader(token) : null;
   
   return {
      prisma,
      userId: decoded ? decoded.userId : undefined,
      req,
      res,
   };
};

