# SQL Application

## NodeJS

Pour tourner sous Node.js version 16.x, taper cette commande dans le terminal :

```bash
export PATH=/usr/node-v16.16.0-linux-x64/bin:$PATH
```

## PostgreSQL

Pour tester la connexion à la bdd on peut faire la commande suivante :

```bash
psql -h <hostname> -p <port> -U <username> -d <database>
```

Par exemple :

```bash
psql -h localhost -U postgres -p 5432 postgres
```

ou alors on peut utiliser la commande :

```bash
psql postgresql://<username>:<password>@<hostname>:<port>/<database>
```

par exemple :

```bash
psql postgresql://postgres:postgres@localhost:5432/postgres
```

## Docker

### Pour rentrer dans le shell

```bash
docker exec -it leyo-apollo sh
```

### PostgreSQL et Prisma

Pour se connecter à la bdd postgresql (container docker) via Prisma il faut d'abord supprimer les migrations de la bdd prisma.

Puis il faut faire attention à utiliser le bon host dans la variable d'environnement `DATABASE_URL` (bien mettre le nom du container docker de postgreSQL)

- `postgresql://<USERNAME>:<PASSWORD>@<HOST>:5432/<DATABASE>?schema=public`

Par exemple : `postgresql://postgres:postgres@postgres:5432/postgres?schema=public`

Ensuite, il faut éxécuter le commande suivante :

```bash
npx prisma generate
```

Et enfin on peut build : ``docker-compose up --build``

```bash
npx prisma migrate dev --name init
```

## Les cookies

- httpOnly: true, impossible pour le browser de lire les cookies (secure server side sessions cookies)
- sameSite: 'strict', éviter les attaques CSRF
- secure: true, les cookies peuvent être mis qu'a travers une connection encryptée
